#!/bin/bash

# ุฅุนุฏุงุฏ ุณุฑูุน ูุจูุช ูููุน ุงูุฃูุตุงุฑ ุงููู ุงููููู
# =====================================

clear
echo "๐ค ุฅุนุฏุงุฏ ุจูุช ูููุน ุงูุฃูุตุงุฑ ุงููู ุงููููู"
echo "======================================="
echo ""

# ุงูุชุญูู ูู Python
if ! command -v python3 &> /dev/null; then
    echo "โ ุฎุทุฃ: Python 3 ุบูุฑ ูุซุจุช"
    echo "ูุฑุฌู ุชุซุจูุช Python 3 ุฃููุงู"
    exit 1
fi

echo "โ ุชู ุงูุนุซูุฑ ุนูู Python 3"

# ุฅูุดุงุก ููู ุงูุฅุนุฏุงุฏุงุช ููุฃูุตุงุฑ ุงููู
echo "๐ ุฅูุดุงุก ููู ุงูุฅุนุฏุงุฏุงุช..."
cp .env.ansarollah .env

# ุชุซุจูุช ุงููุชุทูุจุงุช
echo "๐ฆ ุชุซุจูุช ุงููุชุทูุจุงุช..."
pip3 install -r requirements.txt --quiet

# ุฅุนุทุงุก ุตูุงุญูุงุช ุงูุชุดุบูู
chmod +x run.sh

echo ""
echo "๐ฏ ุชู ุงูุฅุนุฏุงุฏ ุงูุฃููู ุจูุฌุงุญ!"
echo "==============================="
echo ""

# ุทูุจ ุจูุงูุงุช ุงูุจูุช
echo "ูุฑุฌู ุฅุฏุฎุงู ุจูุงูุงุช ุงูุจูุช ุงูุชููุฑุงู:"
echo ""

read -p "๐ ุชููู ุงูุจูุช (Bot Token): " BOT_TOKEN
read -p "๐ข ูุนุฑู ุงูููุงุฉ (Channel ID): " CHANNEL_ID
read -p "๐ค ูุนุฑู ุงููุดุฑู (Admin ID): " ADMIN_ID

# ุชุญุฏูุซ ููู ุงูุฅุนุฏุงุฏุงุช
echo "๐ ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช..."

# ุฅูุดุงุก ููู env ูุคูุช
cat > temp_env << EOF
# ุฅุนุฏุงุฏุงุช ุจูุช ูููุน ุงูุฃูุตุงุฑ ุงููู ุงููููู
BOT_TOKEN=$BOT_TOKEN
CHANNEL_ID=$CHANNEL_ID
ADMIN_IDS=["$ADMIN_ID"]

# ุฅุนุฏุงุฏุงุช ูููุน ุงูุฃูุตุงุฑ ุงููู
WEBSITE_URL=https://www.ansarollah.com.ye
WEBSITE_SECTIONS=["ุฃุฎุจุงุฑ", "ุฃุฎุจุงุฑ ูุญููุฉ", "ุฃุฎุจุงุฑ ุนุฑุจูุฉ", "ุฃุฎุจุงุฑ ุฏูููุฉ", "ุจูุงูุงุช", "ููุงูุงุช"]
CHECK_INTERVAL=120

# ุฅุนุฏุงุฏุงุช Telegraph
TELEGRAPH_TOKEN=
TELEGRAPH_AUTHOR=ููุงุฉ ุงูุฃูุตุงุฑ ุงููู
TELEGRAPH_AUTHOR_URL=https://t.me/ansarollah_channel

# ุฅุนุฏุงุฏุงุช ุงููุดุฑ
AUTO_PUBLISH=false
ENABLE_TEXT_SHORTENING=true
MAX_MESSAGE_LENGTH=4000
SHORT_DESCRIPTION_LENGTH=250

# ุฅุนุฏุงุฏุงุช ุงูุชุฎุตูุต
CUSTOM_HEADER=๐ฐ ุฃุญุฏุซ ุฃุฎุจุงุฑ ุงูุฃูุตุงุฑ ุงููู
CUSTOM_FOOTER=๐ ุชุงุจุนููุง ูููุฒูุฏ ูู ุงูุฃุฎุจุงุฑ ุงูุนุงุฌูุฉ

# ูุงุนุฏุฉ ุงูุจูุงูุงุช
DATABASE_PATH=ansarollah_bot.db

# ุฅุนุฏุงุฏุงุช ุงุณุชุฎุฑุงุฌ ุงููุญุชูู
EXTRACT_IMAGES=true
DOWNLOAD_IMAGES=true

# ููุงุชุฑ ุงููุญุชูู
EXCLUDE_KEYWORDS=["ุฅุนูุงู", "ุฅุนูุงูุงุช", "ุฑุนุงูุฉ"]
INCLUDE_KEYWORDS=["ุนุงุฌู", "ุจูุงู", "ุชุตุฑูุญ", "ูุฑุงุฑ", "ุงูุนุฏูุงู", "ุงูููุงููุฉ", "ููุณุทูู", "ุบุฒุฉ"]
EOF

# ููู ุงูููู ุงููุคูุช
mv temp_env .env

echo "โ ุชู ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช"
echo ""

# ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช
echo "๐ ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช..."
if python3 test_config.py > /dev/null 2>&1; then
    echo "โ ุงูุฅุนุฏุงุฏุงุช ุตุญูุญุฉ"
else
    echo "โ๏ธ  ุชุญุฐูุฑ: ูุฏ ุชุญุชุงุฌ ููุฑุงุฌุนุฉ ุงูุฅุนุฏุงุฏุงุช"
fi

# ุงุฎุชุจุงุฑ ูููุน ุงูุฃูุตุงุฑ ุงููู
echo "๐ ุงุฎุชุจุงุฑ ูููุน ุงูุฃูุตุงุฑ ุงููู..."
if python3 test_ansarollah.py > /dev/null 2>&1; then
    echo "โ ูููู ุงููุตูู ูููููุน ูุงุณุชุฎุฑุงุฌ ุงููุญุชูู"
else
    echo "โ๏ธ  ุชุญุฐูุฑ: ูุดููุฉ ูู ุงููุตูู ูููููุน"
fi

echo ""
echo "๐ ุชู ุงูุฅุนุฏุงุฏ ุจูุฌุงุญ!"
echo "=================="
echo ""
echo "ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "1. ุชุฃูุฏ ูู ุฅุถุงูุฉ ุงูุจูุช ููุดุฑู ูู ุงูููุงุฉ"
echo "2. ุงููุญ ุงูุจูุช ุตูุงุญูุงุช ุงููุดุฑ"
echo "3. ุดุบู ุงูุจูุช ุจุงูุฃูุฑ: ./run.sh"
echo ""
echo "ููุงุฎุชุจุงุฑ ุงููุฏูู:"
echo "- python3 test_config.py"
echo "- python3 test_ansarollah.py"
echo "- python3 main.py"
echo ""

# ุฎูุงุฑ ุงูุชุดุบูู ุงูููุฑู
echo -n "ูู ุชุฑูุฏ ุชุดุบูู ุงูุจูุช ุงูุขูุ (y/n): "
read -r answer
if [[ $answer == "y" || $answer == "Y" || $answer == "ูุนู" ]]; then
    echo ""
    echo "๐ ุชุดุบูู ุงูุจูุช..."
    echo "ุงุณุชุฎุฏู Ctrl+C ููุฅููุงู"
    echo ""
    sleep 2
    ./run.sh
else
    echo ""
    echo "๐ ููููู ุชุดุบูู ุงูุจูุช ูุงุญูุงู ุจุงูุฃูุฑ: ./run.sh"
    echo "๐ ุฑุงุฌุน ููู 'ุฏููู_ุงูุฅุนุฏุงุฏ_ููููุน_ุงูุฃูุตุงุฑ_ุงููู.md' ูููุฒูุฏ ูู ุงูุชูุงุตูู"
fi

echo ""
echo "โจ ุดูุฑุงู ูุงุณุชุฎุฏุงู ุจูุช ูููุน ุงูุฃูุตุงุฑ ุงููู!"